

【python实战】我在大学靠帮别人清理C盘赚够了伙食费

>本篇文章介绍一条大学时赖以生存的绝技，从不外传，今天为了涨粉一条也是拼了！
>
>各位人才确定还不关注吗？

<img src="C:\Users\biaoli.li\AppData\Roaming\Typora\typora-user-images\image-20210609203624963.png" alt="image-20210609203624963" style="zoom:80%;" />

## 实现原理

对于非计算机人员来说，一旦C盘满了就会手足无措，删又不敢删，不删又不行。

所以一条在大学时就发现了这个商机，用python自制**磁盘清理器**。

原理很简单：

**「给定一个文件夹，使用Python检查给定文件夹下有无文件重复，若存在重复则删除」**

## 主要知识点

- `os`模块综合应用
- `glob`模块综合应用
- 利用`filecmp`模块比较两个文件

 ## 步骤分析

该程序实现的逻辑可以具化为：

> 遍历获取给定文件夹下的所有文件，然后通过嵌套循环两两比较文件是否相同，如果相同则删除后者。

实现问题的关键就变成了👇

**如何判断两个文件是否相同？**

在这里我们可以使用`filecmp`模块，来看看官方的介绍文档：

> - **filecmp.cmp(f1, f2, shallow=True)**
> - 比较名为f1和f2的文件，如果它们似乎相等则返回`True`，否则返回`False`
> - 如果`shallow`为真，那么具有相同`os.stat()`签名的文件将会被认为是相等的。否则，将比较文件的内容。

所以可以这样使用👇

```python
# 假设x和y两个文件是相同的
print(filecmp.cmp(x, y))
# True
```

解决了这个问题，我们就可以开始写代码了！

## 代码实现

导入需要的库并设置目标文件夹路径

```python
import os
import glob
import filecmp

dir_path = r'C:\\xxxx'
```

接着遍历获取所有文件的`绝对路径`，我们可以利用`glob`模块的通配符结合`recursive`参数即可完成，框架如下：

```python
for file in glob.glob(path + '/**/*', recursive=True):
    pass
```

由于遍历获取每一个文件或者文件夹后，需要判断是否是文件，如果是文件则可能将绝对路径存放到列表中，这里需要再完成两个事情：

> 1. 首先创建一个空列表，后面用`list.append(i)`添加文件路径
> 2. 接着利用`os.path.isfile(i)`判断是否是文件，返回`True`则执行添加元素的操作

具体代码如下

```python
file_lst = []

for i in glob.glob(dir_path + '/**/*', recursive=True):
    if os.path.isfile(i):
        file_lst.append(i)
```

上一步我们获取了目标文件夹下的所有文件路径，接下来就可以嵌套遍历这个路径列表，其中`filecmp.cmp`进行文件判断，`os.remove`进行文件删除

```python
for x in file_lst:
    for y in file_lst:
        if x != y:
            if filecmp.cmp(x, y):
                os.remove(y)
```

这里的代码已经实现了大致逻辑，但有一个细节需要考虑到：有可能循环到文件已经被前面的判断删除了，导致`os.remove(file)`由于文件不存在而报错。

因此，可以用`os.path.exists`对文件存在进行判断，如下所示：

```python
for x in file_lst:
    for y in file_lst:
        if x != y and os.path.exists(x) and os.path.exists(y):
            if filecmp.cmp(x, y):
                os.remove(y)
```



这样，一个简易的文件去重小程序就完成了，完整代码如下：

```python
import os
import glob
import filecmp

dir_path = r'C:\xxxx'

file_lst = []

for i in glob.glob(dir_path + '/**/*', recursive=True):
    if os.path.isfile(i):
        file_lst.append(i)

for x in file_lst:
    for y in file_lst:
        if x != y and os.path.exists(x) and os.path.exists(y):
            if filecmp.cmp(x, y):
                os.remove(y)
```

## 打包EXE

安装`pyinstaller`库

```python
pip install pyinstaller
```

打包命令

```python
pyinstaller -F -d filename.py
```

----

我是**一条**，一个在互联网摸爬滚打的程序员。

**道阻且长，行则将至**。大家的 **【点赞，收藏，关注】** 就是一条创作的最大动力，我们下期见！

注：关于本篇博客有任何问题和建议，欢迎大家留言！