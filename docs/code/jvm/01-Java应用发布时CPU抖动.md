https://juejin.cn/post/7174610735434547236

## Java编译的过程

- 先由javac编译成通用的中间形式（字节码），该阶段通常被称为编译期。
- 解释器逐条将字节码解释为机器码来执行，该阶段则属于运行期。

为了优化Java字节码运行的性能 ，HotSpot在解释器之外引入了JIT（Just In Time）即时编译器，形成了用解释器+JIT编译器混合的执行引擎，二者会在运行期并肩作战，但分工不同：

- 解释器（Interpreter）：当程序需要迅速启动时，使用解释器解释字节码，节省编译的时间，快速执行
- JIT编译器（JIT Compiler）：在程序启动后并且长时间提供服务时，JIT将越来越多的代码编译为本地机器码，获得更高的执行效率。

![](https://yitiaoit.oss-cn-beijing.aliyuncs.com/img/image-20230516093313755.png)

编译期先由javac将源码编译成字节码，在这个过程中会进行词法分析、语法分析、语义分析等操作，该过程也被称为前端编译。

当类加载完成，程序运行时，JVM会利用热点代码计数器进行判断，如果此时运行的代码是热点代码则使用JIT，如果不是则使用解释器。对于热点代码的判断方式有采样估计和计数两种方式，`Hotspot采用计数方式，到达一定阈值时触发编译`。

大多数情况下解释器首先发挥作用，将字节码按条解释执行。随着时间推移，通过不断对解释的代码进行信息采集，JIT逐渐发挥作用。把越来越多的字节码编译优化为本地机器码并存储在CodeCache中，来获取更高的执行效率。

解释器这时可以作为编译运行的降级手段，在一些不可靠的编译优化出现问题时，再切换回解释执行，保证程序可以正常运行。

JIT极大地提高了Java程序的运行速度，而且跟静态编译相比，即时编译器可以选择性地编译热点代码，省去了很多编译时间，也节省很多的空间。

**有哪些JIT编译器**

- C1（Client Compiler）是一个简单快速的编译器，主要实现浅层的局部优化，而放弃了需要花费大量时间精力的全局深度优化，默认被触发编译的阈值为1500次。 
- C2（Server Compiler）则是专门面向服务器端的，运行时会收集更多信息，花费更多时间，实现更为充分的全局优化，被触发编译的阈值为10000次。

## CPU抖动

应用重新启动时，我们观察到了C1 ComplierThread和C2 ComplierThread线程。而时机也与性能监控的抖动时间刚好吻合，故可以确定是由于应用重启，`大量的代码被识别为热点代码，触发了JIT complier的编译行为从而带来了CPU利用率的飙高`。





